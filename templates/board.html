<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>IDS User Study</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
    <style>
        html,
        body {
            font-family: Arial, Helvetica, sans-serif;
        }

        .page {
            margin: 40px auto;
            width: 80%;
        }

        .hidden {
            display: none;
        }

        ul {
          padding-inline-start: 20px;
          margin-block-start: 5px;
          margin-block-end: 5px;
          margin-right: 1vw
        }
    </style>
</head>

<body>
    <!-- INTRODUCTION PART : Shown first -->
    <div class="intro page">
        <div class="sticky_header" style="position: sticky; top:0px; z-index:100; background-color:beige; padding:0px 16px;">
          <h1> Testing User Experience of Reading Article on the Web </h1>
          <br>
          <label for="ds">Choose DS:</label>
          <select name="ds" id="ds" onchange="onChange1()">
            <option value="urb">1: Urbanizaion</option>
            <option value="hap">2: Happiness</option>
            <option value="snp">3: COVID S&P</option>
            <option value="mor">4: Mortality Rate</option>
          </select>
          <label for="condition">Choose Condition:</label>
          <select name="condition" id="condition" onchange="onChange2()">
            <option value="SA">Static vs Animated</option>
            <option value="SI">Static vs Immersive</option>
            <option value="AI">Animated vs Immersive</option>
          </select>
          <button style="margin-left: 100px;" onclick="downloadBlob()"> Export as CSV </button>
        </div>
        <br><br><br>
        <div style="width: 100%; display:flex; flex-direction:column; line-height: 1.5em">
          <div style="width: 100%; margin-down: 1vw">
            <h3> Interest </h3>
            <div style="width: 100%; display:flex; flex-direction:row;">
              <div style="width: 400px; height:600px;">
                <div id="plot_int"></div>
              </div>
              <div style="width: calc(100% - 400px); display:flex; flex-direction:row;">
                  {% for scores in [[-3, -2, -1], [0], [3, 2, 1]] %}
                    <ul id="list_int{{scores[0]}}">
                      <li> <strong>{{ scores[0] }}</strong> </li>
                      {% for item in UCS_int if item["score"] in scores %}
                        <li>{{ item["score"] }}: {{ item["comment"] }}</li>
                      {% endfor %}
                    </ul>
                  {% endfor %}
              </div>
            </div>
          </div>
          <div style="width: 100%; margin-down: 1vw">
            <h3> Easy to Understand </h3>
            <div style="width: 100%; display:flex; flex-direction:row;">
              <div style="width: 400px; height:600px;">
                <div id="plot_eas"></div>
              </div>
              <div style="width: calc(100% - 400px); display:flex; flex-direction:row;">
                  {% for scores in [[-3, -2, -1], [0], [3, 2, 1]] %}
                    <ul id="list_eas{{scores[0]}}">
                      <li> <strong>{{ scores[0] }}</strong> </li>
                      {% for item in UCS_eas if item["score"] in scores %}
                        <li>{{ item["score"] }}: {{ item["comment"] }}</li>
                      {% endfor %}
                    </ul>
                  {% endfor %}
              </div>
            </div>
          </div>
          <div style="width: 100%; margin-down: 1vw">
            <h3> Persuasive </h3>
            <div style="width: 100%; display:flex; flex-direction:row;">
              <div style="width: 400px; height:600px;">
                <div id="plot_per"></div>
              </div>
              <div style="width: calc(100% - 400px); display:flex; flex-direction:row;">
                  {% for scores in [[-3, -2, -1], [0], [3, 2, 1]] %}
                    <ul id="list_per{{scores[0]}}">
                      <li> <strong>{{ scores[0] }}</strong> </li>
                      {% for item in UCS_per if item["score"] in scores %}
                        <li>{{ item["score"] }}: {{ item["comment"] }}</li>
                      {% endfor %}
                    </ul>
                  {% endfor %}
              </div>
            </div>
          </div>
          <div style="width: 100%; margin-down: 1vw">
            <h3> Trustworthy </h3>
            <div style="width: 100%; display:flex; flex-direction:row;">
              <div style="width: 400px; height:600px;">
                <div id="plot_tru"></div>
              </div>
              <div style="width: calc(100% - 400px); display:flex; flex-direction:row;">
                  {% for scores in [[-3, -2, -1], [0], [3, 2, 1]] %}
                    <ul id="list_tru{{scores[0]}}">
                      <li> <strong>{{ scores[0] }}</strong> </li>
                      {% for item in UCS_tru if item["score"] in scores %}
                        <li>{{ item["score"] }}: {{ item["comment"] }}</li>
                      {% endfor %}
                    </ul>
                  {% endfor %}
              </div>
            </div>
          </div>
          <div style="width: 100%; margin-down: 1vw">
            <h3> Curious </h3>
            <div style="width: 100%; display:flex; flex-direction:row;">
              <div style="width: 400px; height:600px;">
                <div id="plot_cur"></div>
              </div>
              <div style="width: calc(100% - 400px); display:flex; flex-direction:row;">
                  {% for scores in [[-3, -2, -1], [0], [3, 2, 1]] %}
                    <ul id="list_cur{{scores[0]}}">
                      <li> <strong>{{ scores[0] }}</strong> </li>
                      {% for item in UCS_cur if item["score"] in scores %}
                        <li>{{ item["score"] }}: {{ item["comment"] }}</li>
                      {% endfor %}
                    </ul>
                  {% endfor %}
              </div>
            </div>
          </div>
        </div>
        <br/>
        <div style="width: fit-content; display:flex; flex-direction:row; line-height: 1.5em">
          <ul style="font-size:16px; line-height:1.5em;">
            {% for d in data1 %}
              <li>{{ d.Json["M1-1"] }} / {{ d.Json["M2"] }} / {{ d.Json["M3"] }}</li>
            {% endfor %}
          </ul>
          <div style="margin: 0px 20px">
            <div id="plot_M1"></div>
            <div id="plot_M2"></div>
            <div id="plot_M3"></div>
          </div>
        </div>
        <div style="width: fit-content; display:flex; flex-direction:row; line-height: 1.5em">
          <div id="plot_M111"></div>
          <div id="plot_M112"></div>
          <div id="plot_M121"></div>
          <div id="plot_M122"></div>
          <div id="plot_M131"></div>
          <div id="plot_M132"></div>
        </div>

        <script>
          const hist_int = document.getElementById('plot_int');
          const hist_eas = document.getElementById('plot_eas');
          const hist_per = document.getElementById('plot_per');
          const hist_tru = document.getElementById('plot_tru');
          const hist_cur = document.getElementById('plot_cur');

          const lists = [
            [
              document.getElementById('list_int-3'),
              document.getElementById('list_int0'),
              document.getElementById('list_int3')
            ],
            [
              document.getElementById('list_eas-3'),
              document.getElementById('list_eas0'),
              document.getElementById('list_eas3')
            ],
            [
              document.getElementById('list_per-3'),
              document.getElementById('list_per0'),
              document.getElementById('list_per3')
            ],
            [
              document.getElementById('list_tru-3'),
              document.getElementById('list_tru0'),
              document.getElementById('list_tru3')
            ],
            [
              document.getElementById('list_cur-3'),
              document.getElementById('list_cur0'),
              document.getElementById('list_cur3')
            ],
          ]

          const cats = ["int", "eas", "per", "tru", "cur"];

          let ds = 0;
          let condition = 0;
          const dsFormat = {
            int:{
              cond_100_101: [],
              cond_100_110: [],
              cond_101_110: [],
            },
            eas:{
              cond_100_101: [],
              cond_100_110: [],
              cond_101_110: [],
            },
            per:{
              cond_100_101: [],
              cond_100_110: [],
              cond_101_110: [],
            },
            tru:{
              cond_100_101: [],
              cond_100_110: [],
              cond_101_110: [],
            },
            cur:{
              cond_100_101: [],
              cond_100_110: [],
              cond_101_110: [],
            },
          };
          let dss = [dsFormat, dsFormat, dsFormat, dsFormat];
          const ucss = [
            {{ UCS_int | tojson }},
            {{ UCS_eas | tojson }},
            {{ UCS_per | tojson }},
            {{ UCS_tru | tojson }},
            {{ UCS_cur | tojson }}
          ];

          for(let i=0; i<ucss.length; i++){
            for(let j=0; j<ucss[i].length; j++){
              if(ucss[i][j].DS_Task.includes('100') && ucss[i][j].DS_Task.includes('101')){
                dss[ucss[i][j].DS][cats[i]].cond_100_101.push(ucss[i][j].DS_Task.includes('100/')?ucss[i][j].score:-ucss[i][j].score);
              }else if(ucss[i][j].DS_Task.includes('100') && ucss[i][j].DS_Task.includes('110')){
                dss[ucss[i][j].DS][cats[i]].cond_100_110.push(ucss[i][j].DS_Task.includes('100/')?ucss[i][j].score:-ucss[i][j].score);
              }else if(ucss[i][j].DS_Task.includes('101') && ucss[i][j].DS_Task.includes('110')){
                dss[ucss[i][j].DS][cats[i]].cond_101_110.push(ucss[i][j].DS_Task.includes('101/')?ucss[i][j].score:-ucss[i][j].score);
              }
            }
          }

          const layout = {
            barmode:"overlay",
            xaxis: { fixedrange: true, range: [-3.5, 3.5], showticklabels: true },
            yaxis: { fixedrange: true, range: [0, 20] }
          };

          function drawPlots(){
            let hists = [hist_int, hist_eas, hist_per, hist_tru, hist_cur];
            for(let i=0; i<5; i++){
              data_ds = dss[ds][cats[i]];
              data_condition = condition==0?data_ds.cond_100_101:condition==1?data_ds.cond_100_110:data_ds.cond_101_110;
              Plotly.newPlot(hists[i], [{
                x: data_condition,
                type: 'histogram',
                opacity: 0.5,
                autobinx: false,
                histnorm: "count",
                marker:{ color: 'green' },
                xbins: { end: 3.5, size: 1, start: -3.5 }
              }], layout);
            }
          }

          function changeLists(){
            for(let j=0; j<lists.length; j++){
              for(let i=0; i<3; i++){
                lists[j][i].innerHTML = "";
              }
            }
            let list_arr = [[], [], [], [], []];

            for(let j=0; j<ucss.length; j++){
              for(let i=0; i<ucss[j].length; i++){
                if(ucss[j][i].DS == ds){
                  if(condition == 0 && ucss[j][i].DS_Task.includes('100') && ucss[j][i].DS_Task.includes('101')){
                    list_arr[j].push([
                      "<li>" + String(ucss[j][i].FirstTask==100?ucss[j][i].score:-ucss[j][i].score) + ": " + ucss[j][i].comment + "</li>", ucss[j][i].FirstTask==100?ucss[j][i].score:-ucss[j][i].score
                    ])
                  }else if(condition == 1 && ucss[j][i].DS_Task.includes('100') && ucss[j][i].DS_Task.includes('110')){
                    list_arr[j].push([
                      "<li>" + String(ucss[j][i].FirstTask==100?ucss[j][i].score:-ucss[j][i].score) + ": " + ucss[j][i].comment + "</li>", ucss[j][i].FirstTask==100?ucss[j][i].score:-ucss[j][i].score
                    ])
                  }else if(condition == 2 && ucss[j][i].DS_Task.includes('101') && ucss[j][i].DS_Task.includes('110')){
                    list_arr[j].push([
                      "<li>" + String(ucss[j][i].FirstTask==101?ucss[j][i].score:-ucss[j][i].score) + ": " + ucss[j][i].comment + "</li>", ucss[j][i].FirstTask==101?ucss[j][i].score:-ucss[j][i].score
                    ])
                  }
                }
              }
              list_arr[j].sort((a, b)=>{
                return b[1]-a[1];
              });
              for(let i=0; i<list_arr[j].length; i++){
                let temp = list_arr[j][i][1]<0?0:list_arr[j][i][1]==0?1:2;
                lists[j][temp].innerHTML += list_arr[j][i][0];
              }
            }
          }

          function onChange1(){
            ds = document.getElementById('ds').selectedIndex;
            drawPlots();
            changeLists();
          }

          function onChange2(){
            condition = document.getElementById('condition').selectedIndex;
            drawPlots();
            changeLists();
          }

          // baseline chart = ds0_Stt_Anm
          drawPlots()
          changeLists();

          function dataToArray(){
            const demos = {{ data3 | tojson }};
            let result = [["ID", "AGE", "English Reading Proficiency", "Number of Articles Reading on Web", "Gender", "Highest Educational Level", "DS##", "Cond_1", "CondCode_1", "Cond_2", "CondCode_2", "FirstSeen", "Score", "Factor", "Comment"]];
            for(let i=0; i<ucs_int.length; i++){
              let temp = [];
              // ID
              temp.push(ucs_int[i].ID);
              // Demo
              let demo = demos.find(ele => ele.ID == ucs_int[i].ID);
              temp.push(demo!=undefined?demo.Json.AGE:"not found");
              temp.push(demo!=undefined?demo.Json.ERP:"not found");
              temp.push(demo!=undefined?demo.Json.FOW:"not found");
              temp.push(demo!=undefined?demo.Json.GEN:"not found");
              temp.push(demo!=undefined?demo.Json.HEL:"not found");
              // DS##
              temp.push(ucs_int[i].DS);
              // Conds, Score
              if(ucs_int[i].DS_Task.includes('100') && ucs_int[i].DS_Task.includes('101')){
                temp.push("Static");
                temp.push(100);
                temp.push("Animated");
                temp.push(101);
                temp.push(ucs_int[i].DS_Task.includes('100/')?"Static":"Animated");
                temp.push(ucs_int[i].DS_Task.includes('100/')?ucs_int[i].score:-ucs_int[i].score);
              }else if(ucs_int[i].DS_Task.includes('100') && ucs_int[i].DS_Task.includes('110')){
                temp.push("Static");
                temp.push(100);
                temp.push("Immersive");
                temp.push(110);
                temp.push(ucs_int[i].DS_Task.includes('100/')?"Static":"Immersive");
                temp.push(ucs_int[i].DS_Task.includes('100/')?ucs_int[i].score:-ucs_int[i].score);
              }else if(ucs_int[i].DS_Task.includes('101') && ucs_int[i].DS_Task.includes('110')){
                temp.push("Animated");
                temp.push(101);
                temp.push("Immersive");
                temp.push(110);
                temp.push(ucs_int[i].DS_Task.includes('101/')?"Animated":"Immersive");
                temp.push(ucs_int[i].DS_Task.includes('101/')?ucs_int[i].score:-ucs_int[i].score);
              }
              // Factor
              temp.push("INT");
              // Comment
              temp.push(ucs_int[i].comment);
              result.push(temp);
            }
            for(let i=0; i<ucs_eas.length; i++){
              let temp = [];
              // ID
              temp.push(ucs_eas[i].ID);
              // Demo
              let demo = demos.find(ele => ele.ID == ucs_eas[i].ID);
              temp.push(demo!=undefined?demo.Json.AGE:"not found");
              temp.push(demo!=undefined?demo.Json.ERP:"not found");
              temp.push(demo!=undefined?demo.Json.FOW:"not found");
              temp.push(demo!=undefined?demo.Json.GEN:"not found");
              temp.push(demo!=undefined?demo.Json.HEL:"not found");
              // DS##
              temp.push(ucs_eas[i].DS);
              // Conds, Score
              if(ucs_eas[i].DS_Task.includes('100') && ucs_eas[i].DS_Task.includes('101')){
                temp.push("Static");
                temp.push(100);
                temp.push("Animated");
                temp.push(101);
                temp.push(ucs_int[i].DS_Task.includes('100/')?"Static":"Animated");
                temp.push(ucs_eas[i].DS_Task.includes('100/')?ucs_eas[i].score:-ucs_eas[i].score);
              }else if(ucs_eas[i].DS_Task.includes('100') && ucs_eas[i].DS_Task.includes('110')){
                temp.push("Static");
                temp.push(100);
                temp.push("Immersive");
                temp.push(110);
                temp.push(ucs_int[i].DS_Task.includes('100/')?"Static":"Immersive");
                temp.push(ucs_eas[i].DS_Task.includes('100/')?ucs_eas[i].score:-ucs_eas[i].score);
              }else if(ucs_eas[i].DS_Task.includes('101') && ucs_eas[i].DS_Task.includes('110')){
                temp.push("Animated");
                temp.push(101);
                temp.push("Immersive");
                temp.push(110);
                temp.push(ucs_int[i].DS_Task.includes('101/')?"Animated":"Immersive");
                temp.push(ucs_eas[i].DS_Task.includes('101/')?ucs_eas[i].score:-ucs_eas[i].score);
              }
              // Factor
              temp.push("EAS");
              // Comment
              temp.push(ucs_eas[i].comment);
              result.push(temp);
            }
            for(let i=0; i<ucs_per.length; i++){
              let temp = [];
              // ID
              temp.push(ucs_per[i].ID);
              // Demo
              let demo = demos.find(ele => ele.ID == ucs_per[i].ID);
              temp.push(demo!=undefined?demo.Json.AGE:"not found");
              temp.push(demo!=undefined?demo.Json.ERP:"not found");
              temp.push(demo!=undefined?demo.Json.FOW:"not found");
              temp.push(demo!=undefined?demo.Json.GEN:"not found");
              temp.push(demo!=undefined?demo.Json.HEL:"not found");
              // DS##
              temp.push(ucs_per[i].DS);
              // Conds, Score
              if(ucs_per[i].DS_Task.includes('100') && ucs_per[i].DS_Task.includes('101')){
                temp.push("Static");
                temp.push(100);
                temp.push("Animated");
                temp.push(101);
                temp.push(ucs_int[i].DS_Task.includes('100/')?"Static":"Animated");
                temp.push(ucs_per[i].DS_Task.includes('100/')?ucs_per[i].score:-ucs_per[i].score);
              }else if(ucs_per[i].DS_Task.includes('100') && ucs_per[i].DS_Task.includes('110')){
                temp.push("Static");
                temp.push(100);
                temp.push("Immersive");
                temp.push(110);
                temp.push(ucs_int[i].DS_Task.includes('100/')?"Static":"Immersive");
                temp.push(ucs_per[i].DS_Task.includes('100/')?ucs_per[i].score:-ucs_per[i].score);
              }else if(ucs_per[i].DS_Task.includes('101') && ucs_per[i].DS_Task.includes('110')){
                temp.push("Animated");
                temp.push(101);
                temp.push("Immersive");
                temp.push(110);
                temp.push(ucs_int[i].DS_Task.includes('101/')?"Animated":"Immersive");
                temp.push(ucs_per[i].DS_Task.includes('101/')?ucs_per[i].score:-ucs_per[i].score);
              }
              // Factor
              temp.push("PER");
              // Comment
              temp.push(ucs_per[i].comment);
              result.push(temp);
            }
            for(let i=0; i<ucs_tru.length; i++){
              let temp = [];
              // ID
              temp.push(ucs_tru[i].ID);
              // Demo
              let demo = demos.find(ele => ele.ID == ucs_tru[i].ID);
              temp.push(demo!=undefined?demo.Json.AGE:"not found");
              temp.push(demo!=undefined?demo.Json.ERP:"not found");
              temp.push(demo!=undefined?demo.Json.FOW:"not found");
              temp.push(demo!=undefined?demo.Json.GEN:"not found");
              temp.push(demo!=undefined?demo.Json.HEL:"not found");
              // DS##
              temp.push(ucs_tru[i].DS);
              // Conds, Score
              if(ucs_tru[i].DS_Task.includes('100') && ucs_tru[i].DS_Task.includes('101')){
                temp.push("Static");
                temp.push(100);
                temp.push("Animated");
                temp.push(101);
                temp.push(ucs_int[i].DS_Task.includes('100/')?"Static":"Animated");
                temp.push(ucs_tru[i].DS_Task.includes('100/')?ucs_tru[i].score:-ucs_tru[i].score);
              }else if(ucs_tru[i].DS_Task.includes('100') && ucs_tru[i].DS_Task.includes('110')){
                temp.push("Static");
                temp.push(100);
                temp.push("Immersive");
                temp.push(110);
                temp.push(ucs_int[i].DS_Task.includes('100/')?"Static":"Immersive");
                temp.push(ucs_tru[i].DS_Task.includes('100/')?ucs_tru[i].score:-ucs_tru[i].score);
              }else if(ucs_tru[i].DS_Task.includes('101') && ucs_tru[i].DS_Task.includes('110')){
                temp.push("Animated");
                temp.push(101);
                temp.push("Immersive");
                temp.push(110);
                temp.push(ucs_int[i].DS_Task.includes('101/')?"Animated":"Immersive");
                temp.push(ucs_tru[i].DS_Task.includes('101/')?ucs_tru[i].score:-ucs_tru[i].score);
              }
              // Factor
              temp.push("TRU");
              // Comment
              temp.push(ucs_tru[i].comment);
              result.push(temp);
            }
            for(let i=0; i<ucs_cur.length; i++){
              let temp = [];
              // ID
              temp.push(ucs_cur[i].ID);
              // Demo
              let demo = demos.find(ele => ele.ID == ucs_cur[i].ID);
              temp.push(demo!=undefined?demo.Json.AGE:"not found");
              temp.push(demo!=undefined?demo.Json.ERP:"not found");
              temp.push(demo!=undefined?demo.Json.FOW:"not found");
              temp.push(demo!=undefined?demo.Json.GEN:"not found");
              temp.push(demo!=undefined?demo.Json.HEL:"not found");
              // DS##
              temp.push(ucs_cur[i].DS);
              // Conds, Score
              if(ucs_cur[i].DS_Task.includes('100') && ucs_cur[i].DS_Task.includes('101')){
                temp.push("Static");
                temp.push(100);
                temp.push("Animated");
                temp.push(101);
                temp.push(ucs_int[i].DS_Task.includes('100/')?"Static":"Animated");
                temp.push(ucs_cur[i].DS_Task.includes('100/')?ucs_cur[i].score:-ucs_cur[i].score);
              }else if(ucs_cur[i].DS_Task.includes('100') && ucs_cur[i].DS_Task.includes('110')){
                temp.push("Static");
                temp.push(100);
                temp.push("Immersive");
                temp.push(110);
                temp.push(ucs_int[i].DS_Task.includes('100/')?"Static":"Immersive");
                temp.push(ucs_cur[i].DS_Task.includes('100/')?ucs_cur[i].score:-ucs_cur[i].score);
              }else if(ucs_cur[i].DS_Task.includes('101') && ucs_cur[i].DS_Task.includes('110')){
                temp.push("Animated");
                temp.push(101);
                temp.push("Immersive");
                temp.push(110);
                temp.push(ucs_int[i].DS_Task.includes('101/')?"Animated":"Immersive");
                temp.push(ucs_cur[i].DS_Task.includes('101/')?ucs_cur[i].score:-ucs_cur[i].score);
              }
              // Factor
              temp.push("CUR");
              // Comment
              temp.push(ucs_cur[i].comment);
              result.push(temp);
            }

            return result;
          }

          function arrayToCsv(data){
            return data.map(row =>
              row
              .map(String)  // convert every value to String
              .map(v => v.replaceAll('"', '""'))  // escape double colons
              .map(v => `"${v}"`)  // quote it
              .join(',')  // comma-separated
            ).join('\r\n');  // rows starting on new lines
          }

          function downloadBlob() {
            const content = arrayToCsv(dataToArray());
            const filename = 'export.csv';
            const contentType = 'text/csv;charset=utf-8;'
            // Create a blob
            let blob = new Blob([content], { type: contentType });
            let url = URL.createObjectURL(blob);

            // Create a link to download it
            let pom = document.createElement('a');
            pom.href = url;
            pom.setAttribute('download', filename);
            pom.click();
          }

          function start() {
            log('start');
            document.location.href = "../story";
          }
        </script>
    </div>
</body>


<script>
  $.ready(() => {
    $(".page").addClass("hidden");
    $(".intro").removeClass("hidden");
  });
</script>

</html>
